class Quizner{_prefixPlugin="[ Quizner ]";_Errors={REQUIRED_OPTIONS:"Отсутствуют обязательные опции: { %i% }",MAIN_ELEMENT_NULL:"Основной элемент по селектору %i% не найден",ARRAY_OPTIONS:"Опции questions, answers должны быть массивом",BUTTON_OPEN_UNDEFINED:"Не найдена кнопка(и) по селектору %i%",ARRAY_QUESTIONS_EMPTY:"Список questions пуст",ARRAY_RESULTS_EMPTY:"Список answers пуст",TEMPLATE_NULL:"Не найден указанный шаблон %i%",TYPE_ANSWERS_NULL:"Не найден указанный тип ответов %i%",QUESTION_FAIL:"В вопросе с index %i% допущена ошибка в заполнении. Обязательные поля: { question, type, answers }",BUTTON_NEXT_NULL:"Кнопка NEXT не найдена по указанному классу %i%",BUTTON_PREV_NULL:"Кнопка PREV не найдена по указанному классу %i%",NOT_POSITION:"Данной позиции %i% не существует",NULL_PAGINATION:"Не найден контейнер пагинации по указанному классу %i%",NULL_PAGINATION_ELEMENT:"Не найден элемент пагинации по указанному классу %i%",NULL_QUESTION_ANSWERS:"У вопроса с index %i% отсуствует обязательная опция answers",NULL_MODAL:"Элемент модального окна по указанному id %i% не найден",NULL_MODAL_CLOSE_BUTTONS:"Не найдены кнопки закрытия по указанному классу %i%",NULL_WARNING:"Элемент ошибки не найден по указанному классу %i%",NULL_FOOTER:"Элемент подвала квиза не найден по указанному классу %i%",NULL_HEAD:"Элемент шапки квиза не найден по указанному классу %i%",NULL_RESULT:"Произошла ошибка! Ни один из результатов не соответствует указанным критериям баллов к ним или не найден",NULL_RESULT_TITLE:"Не указан параметр title для результата с index %i%",CALLBACK_STRING:"Render Callback функции должны возвращать html-string",CALLBACK_NONE:"%i% не найдено"};_templates=[{name:"selects",className:"quizner-tmpl-selects",render:this._htmlTemplateSelects},{name:"results",className:"quizner-tmpl-results",render:this._htmlTemplateResults}];_typesAnswers=[{name:"radio",prefix:!0,className:"radio-questions",render:this._htmlTypeAnswersRadio},{name:"checkbox",prefix:!0,className:"checkbox-questions",render:this._htmlTypeAnswersCheckbox}];_characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";container;openButtons=[];closeButtons=[];modal;templates;template;footer;pagination;paginationText;paginationBullets;warning;head;buttons={prev:null,next:null};idModal;_Init=!1;activeIndexTemplate=0;activeIndex=0;questionLength=0;_defaultBall=0;balls={max:0,current:0};questionState=[];_options={selector:null,requiredField:!0,prefix:"quizner",questions:[],results:[],init:{modal:!0,btn:!1,btnSelector:null},resultTextDefault:"Вы не набрали достаточное количество баллов",modal:{id:null,prefix:"modal-quizner",classNameActive:"modal-quizner--visible",renderModal:null},head:{visible:!0,name:"Квиз",render:null,className:"head"},renderResults:null,footer:{lastVisible:!1,className:"footer",classNameHidden:"footer--hidden"},navigation:{visible:!0,renderPrevButton:null,renderNextButton:null,classNameButton:"button",classNameButtonNext:"button--next",classNameButtonPrev:"button--prev"},warning:{text:"Для получения результата, необходимо ответить на все вопросы",textRequired:"Для перехода к следующиму вопросу, ответье на текущий",className:"warning",classNameActive:"warning--active"},pagination:{visible:!0,className:"quizner-stages",classNameBullet:"stage",classNameBulletActive:"stage--active",classNameText:"text"},templates:[],types:[]};_requiredOptions=["selector","questions","results"];_Callbacks={init:null,questionPrev:null,questionNext:null,questionChange:null,questionLast:null,questionLastEnd:null,questionFirst:null,templateChange:null};_Events={buttonInitQuizCallback:null,buttonNextCallback:null,buttonPrevCallback:null,buttonOpenModalCallback:null,buttonCloseModalCallback:null};constructor(t){this._options=this._compareOptions(t);const e=this._options.init.modal;e&&(this._requiredOptions=[...this._requiredOptions].filter((t=>"selector"!==t)));const s=this._isNoValidObject(t,this._requiredOptions);if(0!==s.length)return this._handleError({level:1,codeError:"REQUIRED_OPTIONS",message:s.join(", ")});if(!Array.isArray(t.questions))return this._handleError({level:1,codeError:"ARRAY_OPTIONS"});if(!Array.isArray(t.results))return this._handleError({level:1,codeError:"ARRAY_OPTIONS"});if(0===t.questions.length)return this._handleError({level:1,codeError:"ARRAY_QUESTIONS_EMPTY"});if(0===t.results.length)return this._handleError({level:1,codeError:"ARRAY_RESULTS_EMPTY"});if(!e&&(this.container=document.querySelector(t.selector),!this.container))return this._handleError({level:1,codeError:"MAIN_ELEMENT_NULL",message:t.selector});if(this._options.init.btn){if(null===this._options.init.btnSelector)return this._handleError({level:1,codeError:"BUTTON_OPEN_OPTION_NULL",message:"Если вы включили кнопки в опциях init { btn: true }, укажите селектор в опции init: { btnSelector }"});if(this._getButtonStart())return this._handleError({level:1,codeError:"BUTTON_OPEN_UNDEFINED",message:this._options.init.btnSelector})}this._options.types.length>0&&this._addTypes([...this._options.types]),this._options.templates.length>0&&this._addTemplates([...this._options.templates]),this._initDependsOnOptions()}_compareOptions(t){return Object.assign({},{...this._options,...t,init:{...this._options.init,...t.init},modal:{...this._options.modal,...t.modal},head:{...this._options.head,...t.head},footer:{...this._options.footer,...t.footer},warning:{...this._options.warning,...t.warning},navigation:{...this._options.navigation,...t.navigation},pagination:{...this._options.pagination,...t.pagination}})}restart(){return!!this._Init&&(this.activeIndexTemplate=0,this.activeIndex=0,this.balls.current=0,this.questionState=[...this._formatStateQuestions([...this._options.questions])],this._options.footer.lastVisible||this.setHiddenFooter(!1),this.setTemplate(this._templates[0].name),this.setQuestion(this.activeIndex),!0)}destroy(){if(!this._Init)return!1;const t=this._options.init.modal;this.activeIndexTemplate=0,this.activeIndex=0,this._defaultBall=0,this.balls={max:0,current:0},this.buttons.next&&this.buttons.next.removeEventListener("click",this._Events.buttonNextCallback),this.buttons.prev&&this.buttons.prev.removeEventListener("click",this._Events.buttonPrevCallback),this._Events.buttonNextCallback=null,this._Events.buttonPrevCallback=null;const e=t=>this._eventClickItems(this.openButtons,t,!1);return t&&(this.openButtons.length>0&&e(this._Events.buttonOpenModalCallback),this.closeButtons.length>0&&this._eventClickItems(this.closeButtons,this._Events.buttonCloseModalCallback,!1),this._Events.buttonOpenModalCallback=null,this._Events.buttonCloseModalCallback=null),!t&&this._options.init.btn&&(this.openButtons.length>0&&e(this._Events.buttonInitQuizCallback),this._Events.buttonInitQuizCallback=null),this.container&&(t?this.container.remove():this.container.innerHTML=""),this.openButtons=[],this.closeButtons=[],this.idModal=null,this.modal=null,this.templates=null,this.template=null,this.footer=null,this.pagination=null,this.paginationText=null,this.paginationBullets=[],this.warning=null,this.head=null,this.buttons={prev:null,next:null},this._Init=!1,!this._Init}init(){return!this._Init&&(this._options.init.modal||(this.container=document.querySelector(this._options.selector)),this._options.init.btn&&this._getButtonStart(),this._initDependsOnOptions())}_initDependsOnOptions(){const t=this._options.init.modal;return t||!t&&!this._options.init.btn?this._init():(!t&&this._options.init.btn&&(this._Events.buttonInitQuizCallback=t=>(t.preventDefault(),this._eventClickItems(this.openButtons,this._Events.buttonInitQuizCallback,!1),this._init()),this._eventClickItems(this.openButtons,this._Events.buttonInitQuizCallback)),!0)}_init(){this.activeIndexTemplate=0,this.activeIndex=0,this._defaultBall=0,this.questionLength=this._options.questions.length,this.questionState=[...this._formatStateQuestions([...this._options.questions])];const t=this._clsNotSelector(this._options.prefix,this._options.modal.prefix),e=this._options.init.modal,s=e?`${t} ${this._options.prefix} ${this._options.prefix}--mode-modal`:this._options.prefix,i=this._htmlQuiz({className:s});if(e){if(this.idModal=this._options.modal.id&&this._isString(this._options.modal.id)?this._options.modal.id:this._generateString(8).trim(),document.body.insertAdjacentHTML("beforeend",this._htmlModal({quiz:i,id:this.idModal})),this.modal=document.getElementById(this.idModal),!this.modal)return this._handleError({level:1,codeError:"NULL_MODAL",message:this.idModal});this.container=this.modal;const t=this._clsPrefix("close",this._options.modal.prefix);if(this.closeButtons=[...this.modal.querySelectorAll(t)],0===this.closeButtons.length)return this._handleError({level:1,codeError:"NULL_MODAL_CLOSE_BUTTONS",message:t});this._initEventsModal()}else this.container.innerHTML=i;if(this.balls.max=this.calcMaxBalls(),this.head=this.container.querySelector(this._clsPrefix(this._options.head.className)),this.footer=this.container.querySelector(this._clsPrefix(this._options.footer.className)),this.warning=this.container.querySelector(this._clsPrefix(this._options.warning.className)),!this.head)return this._handleError({level:1,codeError:"NULL_HEAD",message:this._options.head.className});if(!this.footer)return this._handleError({level:1,codeError:"NULL_FOOTER",message:this._options.footer.className});if(!this.warning)return this._handleError({level:1,codeError:"NULL_FOOTER",message:this._options.warning.className});if(this._options.pagination.visible){const{className:t,classNameText:e,classNameBullet:s}=this._options.pagination,i=this._clsPrefix(t),n=this._clsPrefix(e,t);if(this.pagination=this.container.querySelector(i),this.paginationText=this.container.querySelector(n),!this.paginationText)return this._handleError({level:1,codeError:"NULL_PAGINATION_ELEMENT",message:n});if(!this.pagination)return this._handleError({level:1,codeError:"NULL_PAGINATION",message:i});{const e=this._clsPrefix(s,t);if(this.paginationBullets=this.pagination.querySelectorAll(e),0===this.paginationBullets.length)return this._handleError({level:1,codeError:"NULL_PAGINATION_ELEMENT",message:e});this.setPaginationBullets(this.activeIndex)}}return this.templates=this.container.querySelector(this._clsPrefix("templates")),this.setTemplate(this._templates[0].name),this._options.navigation.visible&&(this._getButtonsNavigate(),this._initEvents()),this._callFuncCallback(this._Callbacks.init),this._Init=!0,this._Init}_handleEventHelper(t,e){return t.preventDefault(),this.isCurrentTemplate("selects")&&(this.saveStateQuestions(),this.setPositionQuestion(e)),!0}_eventClickItems(t,e,s=!0){return t.forEach((t=>{t&&(s?t.addEventListener("click",e):t.removeEventListener("click",e))})),!0}_initEvents(){const{next:t,prev:e}=this._getButtonsNavigate();return t&&(this._Events.buttonNextCallback=t=>{this._handleEventHelper(t,"next")},t.addEventListener("click",this._Events.buttonNextCallback)),e&&(this._Events.buttonPrevCallback=t=>{this._handleEventHelper(t,"prev")},e.addEventListener("click",this._Events.buttonPrevCallback)),!0}_initEventsModal(){return this._options.init.btn&&this.openButtons.length>0&&(this._Events.buttonOpenModalCallback=t=>{t.preventDefault(),this.setModal()},this._eventClickItems(this.openButtons,this._Events.buttonOpenModalCallback)),this.closeButtons.length>0&&(this._Events.buttonCloseModalCallback=t=>{t.preventDefault(),this.setModal(!1)},this._eventClickItems(this.closeButtons,this._Events.buttonCloseModalCallback)),!0}on(t,e){switch(t){case"quizner:init":this._Callbacks.init=e;break;case"question:next":this._Callbacks.questionNext=e;break;case"question:prev":this._Callbacks.questionPrev=e;break;case"question:change":this._Callbacks.questionChange=e;break;case"question:last":this._Callbacks.questionLast=e;break;case"question:lastend":this._Callbacks.questionLastEnd=e;break;case"question:first":this._Callbacks.questionFirst=e;break;case"template:change":this._Callbacks.templateChange=e;break;default:return this._handleError({level:1,functionName:"on(name, callback)",codeError:"CALLBACK_NONE",message:"Событие "+t})}return!0}_handleError({level:t=0,codeError:e=null,message:s="",nameFunction:i=null}){const n=this._prefixPlugin;0===t&&this.destroy();const r=null!==e?this._Errors[e]:e,a=r?r.replace("%i%",s):s,l=new Error(`${n} ${i?`${i} - ${a}`:a}`);return console.error(l),!1}_clsPrefix(t,e=this._options.prefix,s=!0){const i=t.trim();return-1===i.indexOf(" ")?s?`.${e}__${i}`:`${e}__${i}`:i.split(" ").reduce(((t,i,n)=>t+(0!==n?" ":"")+(s?".":"")+e+"__"+i),"")}_clsNotSelector(t,e=this._options.prefix){return this._clsPrefix(t,e,!1)}_isEmpty(t){return void 0===t&&!t}_getMaxOfArray(t){return Math.max.apply(null,t)}_getMinOfArray(t){return Math.min.apply(null,t)}_callFuncCallback(t,e={}){return null!==t&&"function"==typeof t&&t({Quizner:this,...e})}_isString(t){return"string"==typeof t}_isBoolean(t){return"boolean"==typeof t}_isFunction(t){return"function"==typeof t}_callbackRender(t,e){const s=this._callFuncCallback(t,e);return!!s&&(this._isString(s)?s:this._handleError({level:0,codeError:"CALLBACK_STRING",functionName:t.name}))}_isNoValidObject(t={},e=[]){return 0!==e.length?[...e].filter((e=>this._isEmpty(t[e]))):[]}_withFuncValidType(t,e,s){return!!t(e)||this._handleError({level:1,message:s})}_generateString(t){let e=" ";const s=this._characters.length;for(let i=0;i<t;i++)e+=this._characters.charAt(Math.floor(Math.random()*s));return e}_getButtonStart(){return this.openButtons=[...document.querySelectorAll(this._options.init.btnSelector)],0===this.openButtons.length}_getButtonsNavigate(){const{classNameButtonNext:t,classNameButtonPrev:e}=this._options.navigation;if(null===this.buttons.next){const e=this.container.querySelector(this._clsPrefix(t));if(!e)return this._handleError({level:0,codeError:"BUTTON_NEXT_NULL",message:t,functionName:"_getButtonsNavigate()"});this.buttons.next=e}if(null===this.buttons.prev){const t=this.container.querySelector(this._clsPrefix(e));if(!t)return this._handleError({level:0,codeError:"BUTTON_PREV_NULL",message:e,functionName:"_getButtonsNavigate()"});this.buttons.prev=t}return{next:this.buttons.next,prev:this.buttons.prev}}_formatStateQuestions(t){return[...t].map(((t,e)=>{const s=t.answers;return this._isEmpty(s)?this._handleError({level:0,codeError:"NULL_QUESTION_ANSWERS",message:e,functionName:"_formatStateQuestions(questions)"}):{...t,answers:[]}}))}saveStateQuestions(){if(!this._Init)return!1;const{answers:t}=this.getSelectedAnswers();return 0!==t.length&&(this.questionState=[...this.questionState].map(((e,s)=>this.activeIndex===s?{...e,answers:[...t]}:e))),[...this.questionState]}getStateQuestionAnswer(t){if(!this._Init)return!1;return[...this.questionState[this.activeIndex].answers].find((e=>e.name===t))}isStateAnswerResults(){if(!this._Init)return!1;return 0===[...this.questionState].filter((t=>0===t.answers.length)).length}isStateQuestionAnswer(t){if(!this._Init)return!1;const{answers:e}=this.questionState[t];return 0!==e.length}getStateQuestionSelected(t){if(!this._Init)return!1;const{answers:e}=this.questionState[t];return 0!==e.length?[...e].filter((t=>!this._isEmpty(t.checked))):[]}_mapFromResultsToBalls(t,e=100){return[...t].map((t=>{const{ball:s}=t;return this._isEmpty(s)?e:s}))}calcResultsBall(){return!!this._Init&&[...this.questionState].reduce(((t,e,s)=>{if(this.isStateQuestionAnswer(s)){return t+[...this.getStateQuestionSelected(s)].reduce(((t,e)=>{const{ball:s}=e;return t+(this._isEmpty(s)?this._defaultBall:s)}),0)}return t+this.getQuestionDefaultBall(s)}),0)}calcMaxBalls(){if(!this._Init)return!1;return[...this._options.questions].reduce(((t,e,s)=>{const{answers:i}=e,n=this.getQuestionDefaultBall(s);if(0===i.length)return t+0;const r=this._mapFromResultsToBalls(i,n);return t+this._getMaxOfArray(r)}),0)}calcCompareBall(t){if(!this._Init)return!1;const e=[...this._mapFromResultsToBalls(this._options.results)].filter((e=>t>=e));if(0===e.length)return{title:this._options.resultTextDefault,ball:0};const s=1===e.length?e[0]:this._getMaxOfArray(e),i=[...this._options.results].findIndex((t=>t.ball===s));return-1===i?null:{id:i,...this._options.results[i]}}_htmlModal(t){const{quiz:e,id:s}=t,{prefix:i,renderModal:n}=this._options.modal,r=t=>this._clsNotSelector(t,i),a=`id="${s}"`,l=this._callbackRender(n,{quiz:e,prefix:i,htmlId:a});return l||`\n      <div class="${i}" ${a}>\n        <div class="${r("overlay")}"></div>\n        <div class="${r("close")}">\n          <i>\n            <svg\n              viewBox="0 0 23 22"\n              fill="none"\n              xmlns="http://www.w3.org/2000/svg">\n              <path d="M1.4 1L21.4 21" stroke-width="2" stroke-linecap="round" />\n              <path\n                d="M21 1L0.999998 21"\n                stroke-width="2"\n                stroke-linecap="round" />\n            </svg>\n          </i>\n        </div>\n        <div class="${r("content")}">\n          <div class="${r("window window--content")}">\n            ${e}\n          </div>\n        </div>\n      </div>\n    `}_htmlQuiz(t){const{className:e}=t;return`\n      <div class="${e}">\n        ${this._htmlHead()}\n        <div class="${this._clsNotSelector("body")}">\n          <div class="${this._clsNotSelector("templates")}"></div>\n        </div>\n        ${this._htmlFooter()}\n      </div>\n    `}_htmlPagination(){const{visible:t,className:e,classNameBullet:s,classNameText:i}=this._options.pagination;if(!t)return"";return`\n      <div class="${this._clsNotSelector(e)+" "+e}">\n        <div class="${this._clsNotSelector(i,e)}">\n          Шаг ${this.activeIndex+1} из ${this.questionLength}\n        </div>\n        <div class="${this._clsNotSelector("stages",e)}">\n          ${[...this._options.questions].reduce(((t,i)=>t+`\n        <span class="${this._clsNotSelector(s,e)}"></span>\n      `),"")}\n        </div>\n      </div>\n    `}_htmlHead(){const{visible:t,className:e,name:s}=this._options.head;return t?`\n      <div class="${this._clsNotSelector(e)}">\n        <span class="${this._clsNotSelector("quiz-name")}">${s}</span>\n      </div>\n    `:""}_htmlFooter(){const{className:t}=this._options.footer,{text:e,className:s}=this._options.warning;return`\n      <div class="${this._clsNotSelector(t)}">\n        ${this._htmlPagination()}\n        <div class="${this._clsNotSelector(s)}">\n          ${e}\n        </div>\n        ${this._htmlNavigation()}\n      </div>\n    `}_htmlNavigation(){const{visible:t,classNameButton:e,classNameButtonNext:s,classNameButtonPrev:i,renderNextButton:n,renderPrevButton:r}=this._options.navigation;if(!t)return"";return`\n      <div class="${this._clsNotSelector("wrapper-buttons")}">\n        ${(()=>{const t=this._clsNotSelector(`${e} ${i}`),s=this._callbackRender(r,{className:t});return s||`\n        <div class="${t}">\n          <i>\n            <svg\n              viewBox="0 0 12 13"\n              fill="none"\n              xmlns="http://www.w3.org/2000/svg">\n              <path\n                d="M12 6.5L1 6.5M1 6.5L6 12M1 6.5L6 0.804557"\n                stroke-width="1.2" />\n            </svg>\n          </i>\n          <span>Назад</span>\n        </div>\n      `})()}\n        ${(()=>{const t=this._clsNotSelector(e+" "+s),i=this._callbackRender(n,{className:t});return i||`\n        <div class="${t}">\n          <span>Далее</span>\n          <i>\n            <svg\n              viewBox="0 0 12 13"\n              fill="none"\n              xmlns="http://www.w3.org/2000/svg">\n              <path\n                d="M0 6.90228H11M11 6.90228L6 1.40228M11 6.90228L6 12.5977"\n                stroke-width="1.2" />\n            </svg>\n          </i>\n        </div>\n      `})()}\n      </div>\n    `}withHtmlTypeAnswers(t,e){const{name:s,ball:i,prefix:n,index:r,number:a}=e;if(this._isEmpty(s))return"";const l=this._isEmpty(i)?this.getQuestionDefaultBall(a):i,o=this.getStateQuestionAnswer(s);return t({prefix:n,idQuestion:a,value:`${a}-${r}-${l}`,name:s,isChecked:!this._isEmpty(o)&&o.checked})}_htmlTypeAnswersCheckbox({prefix:t,idQuestion:e,value:s,name:i,isChecked:n}){return`\n      <label\n        class="wrapper-checkbox ${t}__wrapper-checkbox">\n        <input\n          class="wrapper-checkbox__input"\n          type="checkbox"\n          name="question${e}"\n          value="${s}"\n          data-name="${i}"\n          ${n?'checked="checked"':""}\n        />\n        <div class="wrapper-checkbox__wrapper">\n          <span class="wrapper-checkbox__squard"></span>\n          <span class="wrapper-checkbox__name">${i}</span>\n        </div>\n      </label>\n    `}_htmlTypeAnswersRadio({prefix:t,idQuestion:e,value:s,name:i,isChecked:n}){return`\n      <label\n        class="wrapper-radio ${t}__wrapper-radio">\n        <input\n          class="wrapper-radio__radio"\n          type="radio"\n          name="question${e}"\n          value="${s}"\n          data-name="${i}"\n          ${n?'checked="checked"':""}\n        />\n        <div class="wrapper-radio__wrapper">\n          <span class="wrapper-radio__circle"></span>\n          <span class="wrapper-radio__name">${i}</span>\n        </div>\n      </label>\n    `}_switchTypeQuestion(t){const{type:e,answers:s,index:i,prefix:n}=t,r=this._typesAnswers.find((t=>t.name===e));if(this._isEmpty(r))return this._handleError({level:0,codeError:"TYPE_ANSWERS_NULL",message:e,functionName:"_switchTypeQuestion(props)"});const a=r.prefix,l=r.className,o=[...s].reduce(((t,e,s)=>{const{name:a,ball:l}=e,o=r.render.bind(this),h={name:a,ball:l,index:s,prefix:n,number:i};return t+this.withHtmlTypeAnswers(o,h)}),"");return`\n      <div class="${a?this._clsNotSelector(l,n):l}">\n        ${o}\n      </div>\n    `}_htmlQuestion({question:t,index:e,prefix:s}){const{question:i,type:n,answers:r}=t;if(this._isEmpty(i)||this._isEmpty(r))return"";const a=n??"radio";if(0===i.length||0===r.length)return this._handleError({level:0,codeError:"QUESTION_FAIL",message:e,functionName:"_htmlQuestion(props)"});const l=this._switchTypeQuestion({type:a,answers:r,index:e,prefix:s});return`\n      <div class="${this._clsNotSelector("wrapper-title",s)}">\n        <div class="${this._clsNotSelector("title",s)}">\n          ${i}\n        </div>\n      </div>\n      ${l}\n    `}_htmlTemplateSelects({className:t}){const e=this.activeIndex,s=this._options.questions[e];return this._htmlQuestion({question:s,index:e,prefix:t})}_htmlTemplateResults({className:t}){this._options.footer.lastVisible||this.setHiddenFooter(),this.balls.current=this.calcResultsBall();const e=this.calcCompareBall(this.balls.current);this._isEmpty(e)&&this._handleError({level:0,codeError:"NULL_RESULT",functionName:"_htmlTemplateResults(props)"});const{title:s,index:i}=e;if(this._isEmpty(s))return this._handleError({level:0,codeError:"NULL_RESULT_TITLE",message:i,functionName:"_htmlTemplateResults(props)"}),"";const n=this._callbackRender(this._options.renderResults,{prefix:t,title:s,balls:this.balls});return n||`\n      <div class="${this._clsNotSelector("text-result",t)}">\n        <span>\n          ${s}\n        </span>\n      </div>\n    `}getSelectedAnswers(){if(!this._Init)return!1;const t=this.template.querySelectorAll(`\n        input[name="question${this.activeIndex}"]:checked\n      `);return 0!==t.length?{answers:[...t].map((t=>{const{ball:e}=this.formatValue(t.value);return{name:t.dataset.name?t.dataset.name:null,ball:e,checked:!0}}))}:{answers:[]}}formatValue(t){if(!this._Init)return!1;if(-1!==t.indexOf("-")){const e=t.split("-");return{questionId:Number.parseInt(e[0]),answerId:Number.parseInt(e[1]),ball:Number.parseInt(e[2])}}return t}setWarning(t=!0,e=this._options.warning.text){if(!this._Init)return!1;const s=this._options.warning.classNameActive;return t?(this.warning.innerHTML!==e&&(this.warning.innerHTML=e),this.warning.classList.add(this._clsNotSelector(s))):this.warning.classList.remove(this._clsNotSelector(s)),!0}setModal(t=!0){return!!this._Init&&(this._options.init.modal&&(t?this.modal.classList.add(this._options.modal.classNameActive):this.modal.classList.remove(this._options.modal.classNameActive)),!0)}setHiddenFooter(t=!0){if(!this._Init)return!1;const e=this._clsNotSelector(this._options.footer.classNameHidden);return t?this.footer.classList.add(e):this.footer.classList.remove(e),!0}setPaginationText(t){return!!this._Init&&(this.paginationText.innerHTML=`Шаг ${t+1} из ${this.questionLength}`,!0)}setPaginationBullets(t){if(!this._Init)return!1;const{className:e,classNameBulletActive:s}=this._options.pagination;return this.paginationBullets.forEach(((i,n)=>{n<=t?i.classList.add(this._clsNotSelector(s,e)):i.classList.remove(this._clsNotSelector(s,e))})),!0}setQuestion(t){if(!this._Init)return!1;this.activeIndex=t;const e=this._options.questions[t],s=this._templates[this.activeIndexTemplate].className,i=this._htmlQuestion({question:e,index:t,prefix:s});return this.template.innerHTML=i,this._options.pagination.visible&&(this.setPaginationBullets(t),this.setPaginationText(t)),this._callFuncCallback(this._Callbacks.questionChange,{id:t}),!0}setPositionQuestion(t="next"){if(!this._Init)return!1;const e={max:this.questionLength-1,current:this.activeIndex,next:this.activeIndex+1,prev:this.activeIndex-1};switch(t){case"next":if(e.next<=e.max){if(this.isRequiredQuestion(e.current)){this.isStateQuestionAnswer(e.current)?(this._callFuncCallback(this._Callbacks.questionNext,{id:e.next}),this.setWarning(!1),this.setQuestion(e.next)):this.setWarning(!0,this._options.warning.textRequired)}else this.setQuestion(e.next)}if(e.current===e.max-1&&this._callFuncCallback(this._Callbacks.questionLast,{id:this.activeIndex}),e.next>e.max)if(this._options.requiredField){if(!this.isStateAnswerResults())return this.setWarning(!0,this._options.warning.text);this._callFuncCallback(this._Callbacks.questionLastEnd),this.setWarning(!1),this.setTemplate("results")}else this.setTemplate("results");break;case"prev":e.prev>=0&&0!==this.activeIndex&&(this._callFuncCallback(this._Callbacks.questionPrev,{id:e.prev}),this.setQuestion(e.prev)),0===this.activeIndex&&this._callFuncCallback(this._Callbacks.questionFirst,{id:this.activeIndex});break;default:return this._handleError({level:0,codeError:"NOT_POSITION",message:t,functionName:"setPositionQuestion(action)"})}return!0}isRequiredQuestion(t){const{required:e}=this._options.questions[t];return!this._isEmpty(e)&&e}getQuestionTypeObject(t){return!!this._Init&&[...this._typesAnswers].find((e=>e.name===t))}getQuestionDefaultBall(t){const{defaultBall:e}=this._options.questions[t];return this._isEmpty(e)?this._defaultBall:e}_getValidArrayHeplerAdd({arrayFilters:t,validKey:e,validationKeys:s,prefixError:i}){return[...t].filter(((t,n)=>{const r=this._isNoValidObject(t,e);if(0!==r.length){const t=`У объекта с index ${n} в массиве опции ${i} отсуствуют следующие поля: { ${r.join(", ")} }`;return this._handleError({level:1,message:t})}if([...s].some((e=>!1===this._withFuncValidType(e.function,t[e.key],e.message.replace("%i%",n)))))return!1;if("string"!=typeof t.render()){const t=`У объекта с index ${n} в массиве опции ${i} значение опции render должно быть типа function и возвращать данные типа string`;return this._handleError({level:1,message:t})}return!0}))}_addTemplates(t){const e="templates",s={arrayFilters:t,validKey:["name","className","render"],validationKeys:[{key:"name",function:this._isString,message:`У объекта с index %i% в массиве опции ${e} значение опции name должно быть типа string`},{key:"className",function:this._isString,message:`У объекта с index %i% в массиве опции ${e} значение опции className должно быть типа string`},{key:"render",function:this._isFunction,message:`У объекта с index %i% в массиве опции ${e} значение опции render должно быть типа function`}],prefixError:e},i=this._getValidArrayHeplerAdd(s);return i.length>0&&(this._templates=[...this._templates,...i],!0)}_addTypes(t){const e="types",s={arrayFilters:t,validKey:["name","prefix","className","render"],validationKeys:[{key:"name",function:this._isString,message:`У объекта с index %i% в массиве опции ${e} значение опции name должно быть типа string`},{key:"className",function:this._isString,message:`У объекта с index %i% в массиве опции ${e} значение опции className должно быть типа string`},{key:"prefix",function:this._isBoolean,message:`У объекта с index %i% в массиве опции ${e} значение опции prefix должно быть типа boolean`},{key:"render",function:this._isFunction,message:`У объекта с index %i% в массиве опции ${e} значение опции render должно быть типа function`}],prefixError:e},i=this._getValidArrayHeplerAdd(s);return i.length>0&&(this._typesAnswers=[...this._typesAnswers,...i],!0)}getAnswerTypes(){return!!this._Init&&[...this._typesAnswers]}setTemplate(t){const e=this._templates.findIndex((e=>e.name===t));if(-1===e)return this._handleError({level:1,codeError:"TEMPLATE_NULL",message:t,functionName:"setTemplate(name)"});this.activeIndexTemplate=e;const s=this._templates[e],i=s.render.bind(this);if(i){const n=document.createElement("div"),r=this._clsPrefix("template template--active",this._options.prefix,!1)+` ${s.className}`;return n.className=r,n.innerHTML=i({className:s.className}),this.templates.innerHTML="",this.templates.appendChild(n),this.template=n,this._callFuncCallback(this._Callbacks.templateChange,{id:e,name:t,content:n}),!0}return!1}getTemplate(){return{current:this._templates[this.activeIndexTemplate],index:this.activeIndexTemplate}}getTemplates(){return!!this._Init&&[...this._templates]}isCurrentTemplate(t){const{current:e}=this.getTemplate(),{name:s}=e;return t===s}}